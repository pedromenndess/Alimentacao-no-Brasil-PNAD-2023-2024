variacao_pessoas,
variacao_percentual
) %>%
# Renomeia e ordena as categorias de forma lógica
mutate(
seguranca_alimentar = case_when(
seguranca_alimentar == "Com segurança alimentar" ~ "Com Segurança Alimentar",
seguranca_alimentar == "Com insegurança alimentar leve" ~ "Insegurança Alimentar Leve",
seguranca_alimentar == "Com insegurança alimentar moderada" ~ "Insegurança Alimentar Moderada",
seguranca_alimentar == "Com insegurança alimentar grave" ~ "Insegurança Alimentar Grave",
TRUE ~ seguranca_alimentar
),
seguranca_alimentar = factor(seguranca_alimentar,
levels = c("Com Segurança Alimentar",
"Insegurança Alimentar Leve",
"Insegurança Alimentar Moderada",
"Insegurança Alimentar Grave"))
) %>%
arrange(seguranca_alimentar)
View(dados_final)
# 1. PREPARAÇÃO E CÁLCULO DA VARIAÇÃO PERCENTUAL E ABSOLUTA (2023 -> 2024)
dados_niveis_variacao_abs <- dados_final %>%
# Filtramos apenas para o Brasil
filter(regioes == "Brasil") %>%
# Filtramos as 4 categorias mutuamente exclusivas
filter(seguranca_alimentar %in% c("Com segurança alimentar",
"Com insegurança alimentar leve",
"Com insegurança alimentar moderada",
"Com insegurança alimentar grave")) %>%
# Selecionamos colunas de ano, absoluto (usando total_moradores) e porcentagem
select(seguranca_alimentar, ano, total_moradores, porcentagem) %>%
# Pivotamos a tabela para comparar os anos
pivot_wider(
# Corrigido aqui para usar 'total_moradores'
names_from = ano,
values_from = c(total_moradores, porcentagem),
names_prefix = c("abs_", "perc_")
) %>%
# Calcula a Variação em Moradores e a Variação Percentual
mutate(
variacao_moradores = abs_2024 - abs_2023,
variacao_percentual = ((abs_2024 - abs_2023) / abs_2023) * 100
) %>%
# Seleciona e ordena as colunas
select(
seguranca_alimentar,
abs_2024,
abs_2023,
variacao_moradores,
variacao_percentual
) %>%
# Renomeia e ordena as categorias de forma lógica
mutate(
seguranca_alimentar = case_when(
seguranca_alimentar == "Com segurança alimentar" ~ "Com Segurança Alimentar",
seguranca_alimentar == "Com insegurança alimentar leve" ~ "Insegurança Alimentar Leve",
seguranca_alimentar == "Com insegurança alimentar moderada" ~ "Insegurança Alimentar Moderada",
seguranca_alimentar == "Com insegurança alimentar grave" ~ "Insegurança Alimentar Grave",
TRUE ~ seguranca_alimentar
),
seguranca_alimentar = factor(seguranca_alimentar,
levels = c("Com Segurança Alimentar",
"Insegurança Alimentar Leve",
"Insegurança Alimentar Moderada",
"Insegurança Alimentar Grave"))
) %>%
arrange(seguranca_alimentar)
# 2. FORMATAÇÃO CIENTÍFICA (ABNT) E GERAÇÃO DA TABELA
n_rows_data <- nrow(dados_niveis_variacao_abs)
library(dplyr)
library(tidyr)
library(knitr)
library(kableExtra)
library(scales)
library(stringr)
install.packages("dplyr")
# --------------- Tabela 4 (Variação em Valores Absolutos dos Níveis de Segurança Alimentar no Brasil)
library(dplyr)
library(tidyr)
library(knitr)
library(kableExtra)
library(scales)
library(stringr)
# 1. PREPARAÇÃO E CÁLCULO DA VARIAÇÃO PERCENTUAL E ABSOLUTA (2023 -> 2024)
dados_niveis_variacao_abs <- dados_final %>%
# Filtramos apenas para o Brasil
filter(regioes == "Brasil") %>%
# Filtramos as 4 categorias mutuamente exclusivas
filter(seguranca_alimentar %in% c("Com segurança alimentar",
"Com insegurança alimentar leve",
"Com insegurança alimentar moderada",
"Com insegurança alimentar grave")) %>%
# Selecionamos colunas de ano, absoluto (usando total_moradores) e porcentagem
select(seguranca_alimentar, ano, total_moradores, porcentagem) %>%
# Pivotamos a tabela para comparar os anos
pivot_wider(
# Corrigido aqui para usar 'total_moradores'
names_from = ano,
values_from = c(total_moradores, porcentagem),
names_prefix = c("abs_", "perc_")
) %>%
# Calcula a Variação em Moradores e a Variação Percentual
mutate(
variacao_moradores = abs_2024 - abs_2023,
variacao_percentual = ((abs_2024 - abs_2023) / abs_2023) * 100
) %>%
# Seleciona e ordena as colunas
select(
seguranca_alimentar,
abs_2024,
abs_2023,
variacao_moradores,
variacao_percentual
) %>%
# Renomeia e ordena as categorias de forma lógica
mutate(
seguranca_alimentar = case_when(
seguranca_alimentar == "Com segurança alimentar" ~ "Com Segurança Alimentar",
seguranca_alimentar == "Com insegurança alimentar leve" ~ "Insegurança Alimentar Leve",
seguranca_alimentar == "Com insegurança alimentar moderada" ~ "Insegurança Alimentar Moderada",
seguranca_alimentar == "Com insegurança alimentar grave" ~ "Insegurança Alimentar Grave",
TRUE ~ seguranca_alimentar
),
seguranca_alimentar = factor(seguranca_alimentar,
levels = c("Com Segurança Alimentar",
"Insegurança Alimentar Leve",
"Insegurança Alimentar Moderada",
"Insegurança Alimentar Grave"))
) %>%
arrange(seguranca_alimentar)
# 2. FORMATAÇÃO CIENTÍFICA (ABNT) E GERAÇÃO DA TABELA
n_rows_data <- nrow(dados_niveis_variacao_abs)
# 1. PREPARAÇÃO E CÁLCULO DA VARIAÇÃO
dados_niveis_variacao_abs <- dados_final %>%
filter(regioes == "Brasil") %>%
filter(seguranca_alimentar %in% c("Com segurança alimentar",
"Com insegurança alimentar leve",
"Com insegurança alimentar moderada",
"Com insegurança alimentar grave")) %>%
select(seguranca_alimentar, ano, total_moradores, porcentagem) %>%
pivot_wider(
names_from = ano,
values_from = c(total_moradores, porcentagem),
names_prefix = c("abs_", "perc_")
) %>%
mutate(
variacao_moradores = abs_2024 - abs_2023,
variacao_percentual = ((abs_2024 - abs_2023) / abs_2023) * 100
) %>%
select(
seguranca_alimentar,
Moradores_2024 = abs_2024,
Moradores_2023 = abs_2023,
Variacao_Absoluta = variacao_moradores,
Variacao_Percentual = variacao_percentual
) %>%
mutate(
seguranca_alimentar = case_when(
seguranca_alimentar == "Com segurança alimentar" ~ "Com Segurança Alimentar",
seguranca_alimentar == "Com insegurança alimentar leve" ~ "Insegurança Alimentar Leve",
seguranca_alimentar == "Com insegurança alimentar moderada" ~ "Insegurança Alimentar Moderada",
seguranca_alimentar == "Com insegurança alimentar grave" ~ "Insegurança Alimentar Grave",
TRUE ~ seguranca_alimentar
),
seguranca_alimentar = factor(seguranca_alimentar,
levels = c("Com Segurança Alimentar",
"Insegurança Alimentar Leve",
"Insegurança Alimentar Moderada",
"Insegurança Alimentar Grave"))
) %>%
arrange(seguranca_alimentar)
# 2. PRINT DO RESULTADO FINAL
print(dados_niveis_variacao_abs)
dados_moradores_brasil <- dados_final %>%
# Filtra apenas para o Brasil e os 4 níveis detalhados
filter(regioes == "Brasil") %>%
filter(seguranca_alimentar %in% c("Com segurança alimentar",
"Com insegurança alimentar leve",
"Com insegurança alimentar moderada",
"Com insegurança alimentar grave")) %>%
# Seleciona as colunas relevantes (usando total_moradores)
select(seguranca_alimentar, ano, total_moradores) %>%
# Pivotagem para ter os anos em colunas
pivot_wider(
names_from = ano,
values_from = total_moradores,
names_prefix = "Moradores_"
) %>%
# Renomeia e ordena as categorias de forma lógica
mutate(
seguranca_alimentar = case_when(
seguranca_alimentar == "Com segurança alimentar" ~ "Com Segurança Alimentar",
seguranca_alimentar == "Com insegurança alimentar leve" ~ "Insegurança Alimentar Leve",
seguranca_alimentar == "Com insegurança alimentar moderada" ~ "Insegurança Alimentar Moderada",
seguranca_alimentar == "Com insegurança alimentar grave" ~ "Insegurança Alimentar Grave",
TRUE ~ seguranca_alimentar
),
seguranca_alimentar = factor(seguranca_alimentar,
levels = c("Com Segurança Alimentar",
"Insegurança Alimentar Leve",
"Insegurança Alimentar Moderada",
"Insegurança Alimentar Grave"))
) %>%
arrange(seguranca_alimentar)
# 2. PRINT DO RESULTADO FINAL
print(dados_moradores_brasil)
# 1. PREPARAÇÃO E CÁLCULO DA VARIAÇÃO (Valores Absolutos e Percentuais)
dados_tabela_6 <- dados_final %>%
# Filtra apenas para o Brasil e os 4 níveis detalhados
filter(regioes == "Brasil") %>%
filter(seguranca_alimentar %in% c("Com segurança alimentar",
"Com insegurança alimentar leve",
"Com insegurança alimentar moderada",
"Com insegurança alimentar grave")) %>%
# Seleciona as colunas relevantes
select(seguranca_alimentar, ano, total_moradores, porcentagem) %>%
# Pivotagem para ter os anos em colunas (separando moradores e proporções)
pivot_wider(
names_from = ano,
values_from = c(total_moradores, porcentagem),
names_prefix = c("abs_", "perc_")
) %>%
# Calcula as Variações
mutate(
variacao_moradores = abs_2024 - abs_2023,
variacao_percentual = ((abs_2024 - abs_2023) / abs_2023) * 100 # Variação percentual baseada em moradores
) %>%
# Renomeia e ordena as categorias de forma lógica
mutate(
seguranca_alimentar = case_when(
seguranca_alimentar == "Com segurança alimentar" ~ "Com Segurança Alimentar",
seguranca_alimentar == "Com insegurança alimentar leve" ~ "Insegurança Alimentar Leve",
seguranca_alimentar == "Com insegurança alimentar moderada" ~ "Insegurança Alimentar Moderada",
seguranca_alimentar == "Com insegurança alimentar grave" ~ "Insegurança Alimentar Grave",
TRUE ~ seguranca_alimentar
),
seguranca_alimentar = factor(seguranca_alimentar,
levels = c("Com Segurança Alimentar",
"Insegurança Alimentar Leve",
"Insegurança Alimentar Moderada",
"Insegurança Alimentar Grave"))
) %>%
arrange(seguranca_alimentar)
# 2. FORMATAÇÃO CIENTÍFICA (ABNT) E GERAÇÃO DA TABELA
n_rows_data <- nrow(dados_tabela_6)
View(dados_final)
library(dplyr)
library(tidyr)
library(knitr)
library(kableExtra)
library(scales)
install.packages("dplyr")
# ----- Tabela 4
# 1. PREPARAÇÃO E SELEÇÃO DOS DADOS
# --------------- Tabela 6 (Moradores, Variação Absoluta e Percentual por Nível)
library(dplyr)
library(tidyr)
library(knitr)
library(kableExtra)
library(scales)
# 1. PREPARAÇÃO E CÁLCULO DA VARIAÇÃO (Valores Absolutos e Percentuais)
dados_tabela_6 <- dados_final %>%
# Filtra apenas para o Brasil e os 4 níveis detalhados
filter(regioes == "Brasil") %>%
filter(seguranca_alimentar %in% c("Com segurança alimentar",
"Com insegurança alimentar leve",
"Com insegurança alimentar moderada",
"Com insegurança alimentar grave")) %>%
# Seleciona as colunas relevantes
select(seguranca_alimentar, ano, total_moradores, porcentagem) %>%
# Pivotagem para ter os anos em colunas (separando moradores e proporções)
pivot_wider(
names_from = ano,
values_from = c(total_moradores, porcentagem),
names_prefix = c("abs_", "perc_")
) %>%
# Calcula as Variações
mutate(
variacao_moradores = abs_2024 - abs_2023,
variacao_percentual = ((abs_2024 - abs_2023) / abs_2023) * 100 # Variação percentual baseada em moradores
) %>%
# Renomeia e ordena as categorias de forma lógica
mutate(
seguranca_alimentar = case_when(
seguranca_alimentar == "Com segurança alimentar" ~ "Com Segurança Alimentar",
seguranca_alimentar == "Com insegurança alimentar leve" ~ "Insegurança Alimentar Leve",
seguranca_alimentar == "Com insegurança alimentar moderada" ~ "Insegurança Alimentar Moderada",
seguranca_alimentar == "Com insegurança alimentar grave" ~ "Insegurança Alimentar Grave",
TRUE ~ seguranca_alimentar
),
seguranca_alimentar = factor(seguranca_alimentar,
levels = c("Com Segurança Alimentar",
"Insegurança Alimentar Leve",
"Insegurança Alimentar Moderada",
"Insegurança Alimentar Grave"))
) %>%
arrange(seguranca_alimentar)
# 2. FORMATAÇÃO CIENTÍFICA (ABNT) E GERAÇÃO DA TABELA
n_rows_data <- nrow(dados_tabela_6)
# Filtra apenas para o Brasil e os 4 níveis detalhados
dados_filtrados <- dados_final %>%
filter(regioes == "Brasil") %>%
filter(seguranca_alimentar %in% c("Com segurança alimentar",
"Com insegurança alimentar leve",
"Com insegurança alimentar moderada",
"Com insegurança alimentar grave")) %>%
select(regioes, seguranca_alimentar, ano, total_moradores, porcentagem)
# 1. PIVOTAGEM 1: Moradores (Valores Absolutos)
dados_moradores <- dados_filtrados %>%
select(-porcentagem) %>% # Remove a coluna porcentagem temporariamente
pivot_wider(
names_from = ano,
values_from = total_moradores,
names_prefix = "abs_" # Apenas um prefixo: abs_
)
# 2. PIVOTAGEM 2: Proporção (Valores Percentuais)
dados_proporcao <- dados_filtrados %>%
select(-total_moradores) %>% # Remove a coluna total_moradores temporariamente
pivot_wider(
names_from = ano,
values_from = porcentagem,
names_prefix = "perc_" # Apenas um prefixo: perc_
)
# 3. JUNÇÃO DOS DADOS E CÁLCULO FINAL (Novo objeto dados_tabela_6_final)
dados_tabela_6_final <- dados_moradores %>%
left_join(dados_proporcao, by = c("regioes", "seguranca_alimentar")) %>%
# Calcula as Variações
mutate(
variacao_moradores = abs_2024 - abs_2023,
variacao_percentual = ((abs_2024 - abs_2023) / abs_2023) * 100
) %>%
# Renomeia e ordena as categorias de forma lógica
mutate(
seguranca_alimentar = case_when(
seguranca_alimentar == "Com segurança alimentar" ~ "Com Segurança Alimentar",
seguranca_alimentar == "Com insegurança alimentar leve" ~ "Insegurança Alimentar Leve",
seguranca_alimentar == "Com insegurança alimentar moderada" ~ "Insegurança Alimentar Moderada",
seguranca_alimentar == "Com insegurança alimentar grave" ~ "Insegurança Alimentar Grave",
TRUE ~ seguranca_alimentar
),
seguranca_alimentar = factor(seguranca_alimentar,
levels = c("Com Segurança Alimentar",
"Insegurança Alimentar Leve",
"Insegurança Alimentar Moderada",
"Insegurança Alimentar Grave"))
) %>%
arrange(seguranca_alimentar)
# 4. FORMATAÇÃO CIENTÍFICA (ABNT) E GERAÇÃO DA TABELA
n_rows_data <- nrow(dados_tabela_6_final)
tabela_abnt_tabela_6_completa <- dados_tabela_6_final %>%
# Formata os números para exibição
mutate(
# Moradores
`Moradores 2024` = number(abs_2024, big.mark = ".", decimal.mark = ",", accuracy = 1),
`Moradores 2023` = number(abs_2023, big.mark = ".", decimal.mark = ",", accuracy = 1),
# Variação Absoluta
`Variação Absoluta` = number(variacao_moradores, big.mark = ".", decimal.mark = ",", accuracy = 1, style_positive = "plus"),
# Variação Percentual
`Variação Percentual (%)` = number(variacao_percentual, accuracy = 0.1, decimal.mark = ",", style_positive = "plus")
) %>%
# Seleciona e renomeia as colunas na ordem final
select(`Nível de Segurança Alimentar` = seguranca_alimentar,
`Moradores 2024`,
`Moradores 2023`,
`Variação Absoluta`,
`Variação Percentual (%)`) %>%
# Gera a tabela usando kable
kable(
caption = '<span style="color: black;">Tabela 6 – Moradores, Variação Absoluta e Percentual por Nível de Segurança Alimentar no Brasil (2023–2024)</span>',
format = "html",
align = "l"
) %>%
kable_styling(
bootstrap_options = "striped",
full_width = FALSE
) %>%
# Adiciona bordas conforme ABNT
row_spec(0, extra_css = "border-bottom: 2px solid black;") %>%
row_spec(n_rows_data, hline_after = TRUE) %>%
# ADICIONA A FONTE/NOTA
add_footnote(
label = "Fonte: PNAD/SIDRA (Tabela 9751) | Autor: João Pedro",
notation = "none"
)
tabela_abnt_tabela_6_completa
View(dados_tabela_6_final)
# 1. PREPARAÇÃO E CÁLCULO DA VARIAÇÃO
dados_filtrados <- dados_final %>%
filter(regioes == "Brasil") %>%
filter(seguranca_alimentar %in% c("Com segurança alimentar",
"Com insegurança alimentar leve",
"Com insegurança alimentar moderada",
"Com insegurança alimentar grave")) %>%
# Aplica a multiplicação por 1000 na coluna total_moradores (agora População)
mutate(
total_populacao = total_moradores * 1000
) %>%
select(regioes, seguranca_alimentar, ano, total_populacao, porcentagem)
# 1A. PIVOTAGEM 1: População (Valores Absolutos)
dados_populacao <- dados_filtrados %>%
select(-porcentagem) %>%
pivot_wider(
names_from = ano,
values_from = total_populacao,
names_prefix = "abs_"
)
# 1B. PIVOTAGEM 2: Proporção (Valores Percentuais)
dados_proporcao <- dados_filtrados %>%
select(-total_populacao) %>%
pivot_wider(
names_from = ano,
values_from = porcentagem,
names_prefix = "perc_"
)
# 1C. JUNÇÃO DOS DADOS E CÁLCULO FINAL (Novo objeto dados_tabela_6_final)
dados_tabela_6_final <- dados_populacao %>%
left_join(dados_proporcao, by = c("regioes", "seguranca_alimentar")) %>%
# Calcula as Variações
mutate(
variacao_populacao = abs_2024 - abs_2023,
variacao_percentual = ((abs_2024 - abs_2023) / abs_2023) * 100
) %>%
# Renomeia e ordena as categorias de forma lógica
mutate(
seguranca_alimentar = case_when(
seguranca_alimentar == "Com segurança alimentar" ~ "Com Segurança Alimentar",
seguranca_alimentar == "Com insegurança alimentar leve" ~ "Insegurança Alimentar Leve",
seguranca_alimentar == "Com insegurança alimentar moderada" ~ "Insegurança Alimentar Moderada",
seguranca_alimentar == "Com insegurança alimentar grave" ~ "Insegurança Alimentar Grave",
TRUE ~ seguranca_alimentar
),
seguranca_alimentar = factor(seguranca_alimentar,
levels = c("Com Segurança Alimentar",
"Insegurança Alimentar Leve",
"Insegurança Alimentar Moderada",
"Insegurança Alimentar Grave"))
) %>%
arrange(seguranca_alimentar)
# 2. FORMATAÇÃO CIENTÍFICA (ABNT) E GERAÇÃO DA TABELA
n_rows_data <- nrow(dados_tabela_6_final)
tabela_abnt_tabela_6_completa <- dados_tabela_6_final %>%
# Formata os números para exibição
mutate(
# População (valores absolutos)
`População 2024` = number(abs_2024, big.mark = ".", decimal.mark = ",", accuracy = 1),
`População 2023` = number(abs_2023, big.mark = ".", decimal.mark = ",", accuracy = 1),
# Variação Absoluta
`Variação Absoluta` = number(variacao_populacao, big.mark = ".", decimal.mark = ",", accuracy = 1, style_positive = "plus"),
# Variação Percentual
`Variação Percentual (%)` = number(variacao_percentual, accuracy = 0.1, decimal.mark = ",", style_positive = "plus")
) %>%
# Seleciona e renomeia as colunas na ordem final
select(`Nível de Segurança Alimentar` = seguranca_alimentar,
`População 2024`,
`População 2023`,
`Variação Absoluta`,
`Variação Percentual (%)`) %>%
# Gera a tabela usando kable
kable(
caption = '<span style="color: black;">Tabela 6 – População, Variação Absoluta e Percentual por Nível de Segurança Alimentar no Brasil (2023–2024)</span>',
format = "html",
align = "l"
) %>%
kable_styling(
bootstrap_options = "striped",
full_width = FALSE
) %>%
# Adiciona bordas conforme ABNT
row_spec(0, extra_css = "border-bottom: 2px solid black;") %>%
row_spec(n_rows_data, hline_after = TRUE) %>%
# ADICIONA A FONTE/NOTA
add_footnote(
label = "Fonte: PNAD/SIDRA (Tabela 9751) | Autor: João Pedro",
notation = "none"
)
tabela_abnt_tabela_6_completa
tabela_abnt_tabela_6_completa <- dados_tabela_6_final %>%
# Formata os números para exibição
mutate(
# População (valores absolutos)
`População 2024` = number(abs_2024, big.mark = ".", decimal.mark = ",", accuracy = 1),
`População 2023` = number(abs_2023, big.mark = ".", decimal.mark = ",", accuracy = 1),
# Variação Absoluta
`Variação Absoluta` = number(variacao_populacao, big.mark = ".", decimal.mark = ",", accuracy = 1, style_positive = "plus"),
# Variação Percentual
`Variação Percentual (%)` = number(variacao_percentual, accuracy = 0.1, decimal.mark = ",", style_positive = "plus")
) %>%
# Seleciona e renomeia as colunas na ordem final
select(`Nível de Segurança Alimentar` = seguranca_alimentar,
`População 2024`,
`População 2023`,
`Variação Absoluta`,
`Variação Percentual (%)`) %>%
# Gera a tabela usando kable
kable(
caption = '<span style="color: black;">Tabela 4 – População, Variação Absoluta e Percentual por Nível de Segurança Alimentar no Brasil (2023–2024)</span>',
format = "html",
align = "l"
) %>%
kable_styling(
bootstrap_options = "striped",
full_width = FALSE
) %>%
# Adiciona bordas conforme ABNT
row_spec(0, extra_css = "border-bottom: 2px solid black;") %>%
row_spec(n_rows_data, hline_after = TRUE) %>%
# ADICIONA A FONTE/NOTA
add_footnote(
label = "Fonte: PNAD/SIDRA (Tabela 9751) | Autor: João Pedro",
notation = "none"
)
tabela_abnt_tabela_6_completa
